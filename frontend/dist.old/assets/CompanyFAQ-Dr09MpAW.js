import{r as l,v as _,_ as q,a6 as J,a2 as K,aa as Z,ah as ee,z as te,X as ne,at as re,L as ae,O as k,au as se,j as t,av as V,B as S,S as N}from"./index-Bl3f9Dxg.js";import{d as oe}from"./get-BQpI_nQr.js";import{p as P}from"./post-D6em6Wc_.js";import{p as le,a as ce}from"./delete-ByD738uV.js";import{F as w,R as z,C,a as ie}from"./index-CeCeQLHZ.js";import{T as de,R as me}from"./index-C0z08d09.js";import{R as ue,C as pe}from"./index-Bqr4MUQ8.js";import{F as fe}from"./Table-DBWGcoSo.js";import{M as ye}from"./index-CXEQRxaO.js";import{I as B}from"./index-Iy0nxoBl.js";import{S as D}from"./index-BomJZn6k.js";import{T as he}from"./index-F0Avwo3O.js";import{P as ge}from"./index-C_AXlx1A.js";import{R as xe}from"./DeleteOutlined-CnObY5OX.js";import"./TextArea-DyQsbb_N.js";import"./SearchOutlined-BOVmvXrh.js";import"./CheckOutlined-kg7jghGR.js";import"./CopyOutlined-Bj_E3pFL.js";import"./index-DHL8gz9z.js";import"./index-CrloEOjG.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M632 888H392c-4.4 0-8 3.6-8 8v32c0 17.7 14.3 32 32 32h192c17.7 0 32-14.3 32-32v-32c0-4.4-3.6-8-8-8zM512 64c-181.1 0-328 146.9-328 328 0 121.4 66 227.4 164 284.1V792c0 17.7 14.3 32 32 32h264c17.7 0 32-14.3 32-32V676.1c98-56.7 164-162.7 164-284.1 0-181.1-146.9-328-328-328zm127.9 549.8L604 634.6V752H420V634.6l-35.9-20.8C305.4 568.3 256 484.5 256 392c0-141.4 114.6-256 256-256s256 114.6 256 256c0 92.5-49.4 176.3-128.1 221.8z"}}]},name:"bulb",theme:"outlined"},je=function(r,s){return l.createElement(_,q({},r,{ref:s,icon:ve}))},M=l.forwardRef(je),Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},Fe=function(r,s){return l.createElement(_,q({},r,{ref:s,icon:Se}))},we=l.forwardRef(Fe);const Ce=e=>{const{value:r,formatter:s,precision:n,decimalSeparator:o,groupSeparator:h="",prefixCls:u}=e;let i;if(typeof s=="function")i=s(r);else{const c=String(r),m=c.match(/^(-?)(\d*)(\.(\d+))?$/);if(!m||c==="-")i=c;else{const g=m[1];let x=m[2]||"0",f=m[4]||"";x=x.replace(/\B(?=(\d{3})+(?!\d))/g,h),typeof n=="number"&&(f=f.padEnd(n,"0").slice(0,n>0?n:0)),f&&(f=`${o}${f}`),i=[l.createElement("span",{key:"int",className:`${u}-content-value-int`},g,x),f&&l.createElement("span",{key:"decimal",className:`${u}-content-value-decimal`},f)]}}return l.createElement("span",{className:`${u}-content-value`},i)},be=e=>{const{componentCls:r,marginXXS:s,padding:n,colorTextDescription:o,titleFontSize:h,colorTextHeading:u,contentFontSize:i,fontFamily:c}=e;return{[r]:Object.assign(Object.assign({},Z(e)),{[`${r}-title`]:{marginBottom:s,color:o,fontSize:h},[`${r}-skeleton`]:{paddingTop:n},[`${r}-content`]:{color:u,fontSize:i,fontFamily:c,[`${r}-content-value`]:{display:"inline-block",direction:"ltr"},[`${r}-content-prefix, ${r}-content-suffix`]:{display:"inline-block"},[`${r}-content-prefix`]:{marginInlineEnd:s},[`${r}-content-suffix`]:{marginInlineStart:s}}})}},Ae=e=>{const{fontSizeHeading3:r,fontSize:s}=e;return{titleFontSize:s,contentFontSize:r}},Ee=J("Statistic",e=>{const r=K(e,{});return be(r)},Ae);var $e=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(s[n[o]]=e[n[o]]);return s};const A=l.forwardRef((e,r)=>{const{prefixCls:s,className:n,rootClassName:o,style:h,valueStyle:u,value:i=0,title:c,valueRender:m,prefix:g,suffix:x,loading:f=!1,formatter:p,precision:y,decimalSeparator:j=".",groupSeparator:E=",",onMouseEnter:$,onMouseLeave:b}=e,O=$e(e,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:a,direction:d,className:Q,style:L}=ee("statistic"),v=a("statistic",s),[U,X,G]=Ee(v),T=l.createElement(Ce,{decimalSeparator:j,groupSeparator:E,prefixCls:v,formatter:p,precision:y,value:i}),W=te(v,{[`${v}-rtl`]:d==="rtl"},Q,n,o,X,G),I=l.useRef(null);l.useImperativeHandle(r,()=>({nativeElement:I.current}));const Y=ne(O,{aria:!0,data:!0});return U(l.createElement("div",Object.assign({},Y,{ref:I,className:W,style:Object.assign(Object.assign({},L),h),onMouseEnter:$,onMouseLeave:b}),c&&l.createElement("div",{className:`${v}-title`},c),l.createElement(re,{paragraph:!1,loading:f,className:`${v}-skeleton`},l.createElement("div",{style:u,className:`${v}-content`},g&&l.createElement("span",{className:`${v}-content-prefix`},g),m?m(T):T,x&&l.createElement("span",{className:`${v}-content-suffix`},x)))))}),Oe=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Qe(e,r){let s=e;const n=/\[[^\]]*]/g,o=(r.match(n)||[]).map(c=>c.slice(1,-1)),h=r.replace(n,"[]"),u=Oe.reduce((c,[m,g])=>{if(c.includes(m)){const x=Math.floor(s/g);return s-=x*g,c.replace(new RegExp(`${m}+`,"g"),f=>{const p=f.length;return x.toString().padStart(p,"0")})}return c},h);let i=0;return u.replace(n,()=>{const c=o[i];return i+=1,c})}function Re(e,r,s){const{format:n=""}=r,o=new Date(e).getTime(),h=Date.now(),u=Math.max(s?o-h:h-o,0);return Qe(u,n)}var Te=function(e,r){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(s[n[o]]=e[n[o]]);return s};function Ie(e){return new Date(e).getTime()}const H=e=>{const{value:r,format:s="HH:mm:ss",onChange:n,onFinish:o,type:h}=e,u=Te(e,["value","format","onChange","onFinish","type"]),i=h==="countdown",[c,m]=l.useState(null),g=ae(()=>{const p=Date.now(),y=Ie(r);m({});const j=i?y-p:p-y;return n?.(j),i&&y<p?(o?.(),!1):!0});l.useEffect(()=>{let p;const y=()=>k.cancel(p),j=()=>{p=k(()=>{g()&&j()})};return j(),y},[r,i]),l.useEffect(()=>{m({})},[]);const x=(p,y)=>c?Re(p,Object.assign(Object.assign({},y),{format:s}),i):"-",f=p=>se(p,{title:void 0});return l.createElement(A,Object.assign({},u,{value:r,valueRender:f,formatter:x}))},ke=e=>l.createElement(H,Object.assign({},e,{type:"countdown"})),Ne=l.memo(ke);A.Timer=H;A.Countdown=Ne;const{Title:Pe,Text:R}=de,{TextArea:ze}=B,{Option:F}=D,Me=()=>{const{message:e}=V.useApp(),[r,s]=l.useState([]),[n,o]=l.useState(!1),[h,u]=l.useState(!1),[i,c]=l.useState(null),[m]=w.useForm(),[g,x]=l.useState({company_id:"",company_name:"",count:0}),[f,p]=l.useState(!1),y=async()=>{o(!0);try{const a=await oe("/chatbot/admin/company-faqs/");a.data?(s(a.data.results),x({company_id:a.data.company_id,company_name:a.data.company_name,count:a.data.count})):e.error("Failed to load company FAQs")}catch(a){console.error("Error loading FAQs:",a),e.error("Failed to load company FAQs")}finally{o(!1)}};l.useEffect(()=>{y()},[]);const j=async a=>{try{const d={...a,category:Array.isArray(a.category)?a.category[0]:a.category};console.log("Submitting FAQ data:",d),i?(await le(`/chatbot/admin/company-faqs/${i.id}/`,d)).data?(e.success("FAQ updated successfully"),y()):e.error("Failed to update FAQ"):(await P("/chatbot/admin/company-faqs/create/",d)).data?(e.success("FAQ created successfully"),y()):e.error("Failed to create FAQ"),u(!1),c(null),m.resetFields()}catch(d){console.error("Error saving FAQ:",d),console.error("Error details:",d.response?.data),e.error(`Failed to save FAQ: ${d.response?.data?.error||d.message}`)}},E=async a=>{try{const d=await ce(`/chatbot/admin/company-faqs/${a}/`);d.data||d.status===200?(e.success("FAQ deleted successfully"),y()):e.error("Failed to delete FAQ")}catch(d){console.error("Error deleting FAQ:",d),e.error("Failed to delete FAQ")}},$=async()=>{p(!0);try{(await P("/chatbot/admin/company-faqs/refresh-vectors/",{})).data?e.success("Company FAQ vectors refreshed successfully"):e.error("Failed to refresh vectors")}catch(a){console.error("Error refreshing vectors:",a),e.error("Failed to refresh vectors")}finally{p(!1)}},b=a=>{a?(c(a),m.setFieldsValue({question:a.question,answer:a.answer,category:a.category})):(c(null),m.resetFields()),u(!0)},O=[{title:"Question",dataIndex:"question",key:"question",width:"30%",render:a=>t.jsx(R,{ellipsis:{tooltip:a},style:{maxWidth:200},children:a})},{title:"Answer",dataIndex:"answer",key:"answer",width:"40%",render:a=>t.jsx(R,{ellipsis:{tooltip:a},style:{maxWidth:300},children:a})},{title:"Category",dataIndex:"category",key:"category",width:"15%",render:a=>t.jsx(he,{color:"blue",children:a})},{title:"Actions",key:"actions",width:"15%",render:(a,d)=>t.jsxs(N,{children:[t.jsx(S,{type:"link",icon:t.jsx(me,{}),onClick:()=>b(d),size:"small",children:"Edit"}),t.jsx(ge,{title:"Are you sure you want to delete this FAQ?",onConfirm:()=>E(d.id),okText:"Yes",cancelText:"No",children:t.jsx(S,{type:"link",danger:!0,icon:t.jsx(xe,{}),size:"small",children:"Delete"})})]})}];return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs(z,{gutter:[16,16],style:{marginBottom:"24px"},children:[t.jsxs(C,{span:18,children:[t.jsxs(Pe,{level:2,children:[t.jsx(M,{style:{color:"#1890ff",marginRight:"8px"}}),"Company FAQ Management"]}),t.jsxs(R,{type:"secondary",children:["Manage company-specific FAQs for ",g.company_name," (",g.company_id,")"]})]}),t.jsx(C,{span:6,children:t.jsx(A,{title:"Total FAQs",value:g.count,prefix:t.jsx(ie,{})})})]}),t.jsxs(z,{gutter:[16,16],style:{marginBottom:"24px"},children:[t.jsx(C,{children:t.jsx(S,{type:"primary",icon:t.jsx(ue,{}),onClick:()=>b(),children:"Add New FAQ"})}),t.jsx(C,{children:t.jsx(S,{icon:t.jsx(we,{}),onClick:y,loading:n,children:"Refresh"})}),t.jsx(C,{children:t.jsx(S,{type:"dashed",icon:t.jsx(M,{}),onClick:$,loading:f,children:"Refresh AI Vectors"})})]}),t.jsx(pe,{children:t.jsx(fe,{columns:O,dataSource:r,rowKey:"id",loading:n,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,d)=>`${d[0]}-${d[1]} of ${a} FAQs`}})}),t.jsx(ye,{title:i?"Edit Company FAQ":"Add New Company FAQ",open:h,onCancel:()=>{u(!1),c(null),m.resetFields()},footer:null,width:800,children:t.jsxs(w,{form:m,layout:"vertical",onFinish:j,children:[t.jsx(w.Item,{name:"question",label:"Question",rules:[{required:!0,message:"Please enter the question"}],children:t.jsx(B,{placeholder:"Enter the FAQ question"})}),t.jsx(w.Item,{name:"answer",label:"Answer",rules:[{required:!0,message:"Please enter the answer"}],children:t.jsx(ze,{rows:6,placeholder:"Enter the detailed answer"})}),t.jsx(w.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select a category"}],children:t.jsxs(D,{placeholder:"Select or enter a category",allowClear:!0,showSearch:!0,optionFilterProp:"children",children:[t.jsx(F,{value:"General",children:"General"}),t.jsx(F,{value:"Services",children:"Services"}),t.jsx(F,{value:"Pricing",children:"Pricing"}),t.jsx(F,{value:"Support",children:"Support"}),t.jsx(F,{value:"Technical",children:"Technical"}),t.jsx(F,{value:"Company Info",children:"Company Info"}),t.jsx(F,{value:"Contact",children:"Contact"})]})}),t.jsx(w.Item,{style:{marginBottom:0,textAlign:"right"},children:t.jsxs(N,{children:[t.jsx(S,{onClick:()=>u(!1),children:"Cancel"}),t.jsx(S,{type:"primary",htmlType:"submit",children:i?"Update FAQ":"Create FAQ"})]})})]})})]})},st=()=>t.jsx(V,{children:t.jsx(Me,{})});export{st as default};
