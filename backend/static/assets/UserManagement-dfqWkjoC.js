import{R as U,j as r,r as P,b as W,u as _,B as y,c as q,a as F,s as x,T as B,d as H,e as K}from"./index-Bl3f9Dxg.js";import{C as b}from"./Card-DJULRFTo.js";import{A as Y}from"./AppTable-DUtGyFMW.js";import{F as J}from"./index-BubhaeD9.js";import{C as G}from"./index-DsVMNOFc.js";import{P as Q}from"./index-C_AXlx1A.js";import{a as X,s as Z,A as j}from"./AppInput-CZB3jFkU.js";import{u as ee}from"./index.esm-BmxENRqK.js";import{A as se}from"./AppPassword-DryXLLea.js";import{A as te}from"./AppSelect-qvxPLbLB.js";import{M as re}from"./index-CXEQRxaO.js";import"./Table-DBWGcoSo.js";import"./index-BomJZn6k.js";import"./SearchOutlined-BOVmvXrh.js";import"./CheckOutlined-kg7jghGR.js";import"./index-DHL8gz9z.js";import"./TextArea-DyQsbb_N.js";import"./index-CrloEOjG.js";import"./index-Iy0nxoBl.js";const ae=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),E=(s=>Array.isArray(s)&&s.every(e=>typeof e=="object"&&!(e instanceof Array))),ne=(s=>Array.isArray(s)&&s.every(e=>Array.isArray(e))),oe=(s=>Array.from(s.map(e=>Object.keys(e)).reduce((e,a)=>new Set([...e,...a]),[]))),ie=(s,e)=>{e=e||oe(s);let a=e,t=e;E(e)&&(a=e.map(i=>i.label),t=e.map(i=>i.key));const n=s.map(i=>t.map(l=>le(l,i)));return[a,...n]},le=(s,e)=>{const a=s.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(t,n,i,l){const c=t[n];if(c==null)l.splice(1);else return c},e);return a===void 0?s in e?e[s]:"":a},ce=s=>typeof s>"u"||s===null?"":s,O=((s,e=",",a='"')=>s.filter(t=>t).map(t=>t.map(n=>ce(n)).map(n=>`${a}${n}${a}`).join(e)).join(`
`)),de=((s,e,a,t)=>O(e?[e,...s]:s,a,t)),pe=((s,e,a,t)=>O(ie(s,e),a,t)),me=((s,e,a,t)=>e?`${e.join(a)}
${s}`:s.replace(/"/g,'""')),I=(s,e,a,t)=>{if(E(s))return pe(s,e,a,t);if(ne(s))return de(s,e,a,t);if(typeof s=="string")return me(s,e,a);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},L=((s,e,a,t,n)=>{const i=I(s,a,t,n),l=ae()?"application/csv":"text/csv",c=new Blob([e?"\uFEFF":"",i],{type:l}),p=`data:${l};charset=utf-8,${e?"\uFEFF":""}${i}`,u=window.URL||window.webkitURL;return typeof u.createObjectURL>"u"?p:u.createObjectURL(c)});var C={exports:{}},w,T;function ue(){if(T)return w;T=1;var s="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return w=s,w}var S,R;function he(){if(R)return S;R=1;var s=ue();function e(){}function a(){}return a.resetWarningCache=e,S=function(){function t(l,c,p,u,h,g){if(g!==s){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}t.isRequired=t;function n(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:n,element:t,elementType:t,instanceOf:n,node:t,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:a,resetWarningCache:e};return i.PropTypes=i,i},S}var A;function fe(){return A||(A=1,C.exports=he()()),C.exports}var d=fe();const $={data:d.oneOfType([d.string,d.array,d.func]).isRequired,headers:d.array,target:d.string,separator:d.string,filename:d.string,uFEFF:d.bool,onClick:d.func,asyncOnClick:d.bool,enclosingCharacter:d.string},M={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},ye={target:"_blank"};class ze extends U.Component{static defaultProps=Object.assign(M,ye);static propTypes=$;constructor(e){super(e),this.state={}}buildURI(){return L(...arguments)}componentDidMount(){const{data:e,headers:a,separator:t,enclosingCharacter:n,uFEFF:i,target:l,specs:c,replace:p}=this.props;this.state.page=window.open(this.buildURI(e,i,a,t,n),l,c,p)}getWindow(){return this.state.page}render(){return null}}let ge=class extends U.Component{static defaultProps=M;static propTypes=$;constructor(e){super(e),this.buildURI=this.buildURI.bind(this)}buildURI(){return L(...arguments)}handleLegacy(e,a=!1){if(window.navigator.msSaveOrOpenBlob){e.preventDefault();const{data:t,headers:n,separator:i,filename:l,enclosingCharacter:c,uFEFF:p}=this.props,u=a&&typeof t=="function"?t():t;let h=new Blob([p?"\uFEFF":"",I(u,n,i,c)]);return window.navigator.msSaveBlob(h,l),!1}}handleAsyncClick(e){const a=t=>{if(t===!1){e.preventDefault();return}this.handleLegacy(e,!0)};this.props.onClick(e,a)}handleSyncClick(e){if(this.props.onClick(e)===!1){e.preventDefault();return}this.handleLegacy(e)}handleClick(){return e=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(e):this.handleSyncClick(e);this.handleLegacy(e)}}render(){const{data:e,headers:a,separator:t,filename:n,uFEFF:i,children:l,onClick:c,asyncOnClick:p,enclosingCharacter:u,...h}=this.props,f=typeof window>"u"?"":this.buildURI(e,i,a,t,u);return r.jsx("a",{download:n,...h,ref:v=>this.link=v,target:"_self",href:f,onClick:this.handleClick(),children:l})}};const xe=ge;function be({handleOpenModal:s}){const[e,a]=P.useState([]),[t,n]=W({}),i=Number(t.get("page"))||1,{data:l,isLoading:c,mutate:p}=_(`/admin-dashboard/user-profiles/?page=${i}`),u=async(o,m)=>{try{await F.post("/admin-dashboard/user-profiles/toggle-favorite/",{profile_id:o}),x.success(`User ${m?"removed from":"added to"} favorites`),p()}catch(V){x.error(V?.response?.data?.error||"Failed to update favorite status")}},h=async()=>{try{const o=await F.post("/admin-dashboard/user-profiles/clear-non-favorites/");x.success(o.data.message),p()}catch(o){x.error(o?.response?.data?.error||"Failed to clear profiles")}},g=o=>{n({page:o.toString()})},v={selectedRowKeys:e,onChange:o=>{console.log("selectedRowKeys changed: ",o),a(o)}},D=[{title:"SN",dataIndex:"sn",width:60,render:o=>r.jsx("span",{className:"font-medium",children:o})},{title:"Name",dataIndex:"name",render:o=>r.jsx("span",{className:"font-medium text-gray-900",children:o})},{title:"Phone",dataIndex:"phone",render:(o,m)=>r.jsxs("span",{className:"text-gray-600",children:[m.country_code," ",o]})},{title:"Email Address",dataIndex:"email",render:o=>r.jsx("span",{className:"text-gray-600",children:o||"—"})},{title:"Address",dataIndex:"address",render:o=>r.jsx("span",{className:"text-gray-600",children:o||"—"})},{title:"Last Used",dataIndex:"last_used",render:o=>r.jsx("span",{className:"text-gray-500 text-sm",children:o?new Date(o).toLocaleString():"—"})},{title:"Favorite",dataIndex:"is_favorite",width:80,align:"center",render:(o,m)=>r.jsx(B,{title:m.is_favorite?"Remove from favorites":"Add to favorites",children:r.jsx("div",{className:"cursor-pointer hover:scale-110 transition-transform",onClick:()=>u(m.id,m.is_favorite),children:m.is_favorite?r.jsx(H,{size:18,className:"text-red-500"}):r.jsx(K,{size:18,className:"text-gray-400 hover:text-red-500"})})})}],z=[{label:"SN",key:"sn"},{label:"Name",key:"name"},{label:"Phone",key:"phone"},{label:"Email",key:"email"},{label:"Address",key:"address"},{label:"Country Code",key:"country_code"},{label:"Is Favorite",key:"is_favorite"},{label:"Created At",key:"created_at"},{label:"Last Used",key:"last_used"}],k=l?.results?.map((o,m)=>({...o,key:o.id,sn:(i-1)*10+m+1}))||[],N=l?.count||0;return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex gap-3 items-center",children:[r.jsxs("h6",{className:"font-bold text-xl",children:["User Profiles (",N,")"]}),r.jsx(xe,{data:k.filter(o=>e.includes(o.key)),headers:z,filename:`user-profiles-${new Date().toISOString().split("T")[0]}.csv`,children:r.jsxs(y,{type:"primary",icon:r.jsx(G,{size:16}),disabled:e.length===0,children:["Export (",e.length,")"]})}),r.jsx(Q,{title:"Clear Non-Favorite Users",description:"This will delete all users except those marked as favorites. Are you sure?",onConfirm:h,okText:"Yes, Clear",cancelText:"Cancel",children:r.jsx(y,{type:"primary",danger:!0,icon:r.jsx(q,{size:16}),children:"Clear Non-Favorites"})})]}),r.jsx(y,{type:"primary",className:"!bg-yellow",icon:r.jsx(J,{size:15}),onClick:s,children:"Add User"})]}),r.jsx(Y,{rowKey:"id",rowSelection:v,columns:D,dataSource:k,loading:c,total:N,paginationData:i,handlePagination:g})]})}const ve=()=>{const s=ee({resolver:X(Z),mode:"onChange",defaultValues:{name:"",phone:void 0,email:"",password:"",specialization:""}}),{handleSubmit:e}=s;return{formHooks:s,formSubmit:e(t=>{})}};function je({isModalOpen:s,onCancel:e}){const{formHooks:a,formSubmit:t}=ve(),{control:n,reset:i}=a,l=()=>{e(),i({})};return r.jsx("div",{children:r.jsx(re,{width:700,className:"",title:"Add User",footer:()=>r.jsxs("div",{className:"flex gap-2 items-center justify-end",children:[r.jsx(y,{type:"text",onClick:l,children:"Cancel"}),r.jsx(y,{type:"primary",htmlType:"submit",form:"add-user",children:"Add"})]}),open:s,onCancel:l,centered:!0,children:r.jsxs("form",{onSubmit:t,className:"space-y-4 grid grid-cols-2 gap-3",id:"add-user",children:[r.jsx(j,{control:n,name:"name",label:"Name",placeholder:"Enter name"}),r.jsx(j,{control:n,type:"number",name:"phone",label:"Phone",placeholder:"Enter phone number"}),r.jsx(j,{control:n,name:"email",label:"Email",placeholder:"Enter email"}),r.jsx(se,{control:n,name:"password",label:"Password",placeholder:"Enter password"}),r.jsx(te,{control:n,name:"specialization",label:"specialization",placeholder:"Select specialization",options:[]})]})})})}function We(){const[s,e]=P.useState(!1),{data:a,isLoading:t}=_("/admin-dashboard/user-profiles/stats/"),n=()=>{e(!0)},i=()=>{e(!1)};return t?r.jsxs("div",{className:"pt-4 space-y-5",children:[r.jsx("h2",{className:"font-bold text-2xl",children:"User Management"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-10",children:[1,2,3,4].map(l=>r.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border animate-pulse",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]},l))})]}):r.jsxs("div",{className:"pt-4 space-y-5",children:[r.jsx("h2",{className:"font-bold text-2xl",children:"User Management"}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6",children:[r.jsx(b,{title:"Total Users",count:a?.total_users||0}),r.jsx(b,{title:"Favorite Users",count:a?.favorite_users||0}),r.jsx(b,{title:"Active Users",count:a?.active_users||0}),r.jsx(b,{title:"New Today",count:a?.new_users_today||0})]}),r.jsx(be,{handleOpenModal:n}),s&&r.jsx(je,{isModalOpen:s,onCancel:i})]})}export{We as default};
