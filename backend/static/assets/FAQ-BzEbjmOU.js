import{r,u as O,j as e,B as l,a as g,s as i,S as W}from"./index-Bl3f9Dxg.js";import{h as J,i as U,F as Y,d as H,j as X}from"./index-BubhaeD9.js";import{F as a}from"./index-CeCeQLHZ.js";import{T as Z,C as w}from"./index-Bqr4MUQ8.js";import{I as c}from"./index-Iy0nxoBl.js";import{F as ee}from"./Table-DBWGcoSo.js";import{T as _}from"./index-F0Avwo3O.js";import{M as N}from"./index-CXEQRxaO.js";import{S as A}from"./index-BomJZn6k.js";import{P as se}from"./index-C_AXlx1A.js";import"./SearchOutlined-BOVmvXrh.js";import"./TextArea-DyQsbb_N.js";import"./index-DHL8gz9z.js";import"./index-CrloEOjG.js";import"./CheckOutlined-kg7jghGR.js";const{TextArea:T}=c,{Option:F}=A,C=[{key:"general_queries",label:"General Queries",subcategories:["study_abroad_basics","visa_information","accommodation","custom_entries"]},{key:"language_requirements",label:"Language Requirements",subcategories:["english_speaking_countries","non_english_countries"]},{key:"scholarships",label:"Scholarships",subcategories:["global_opportunities","country_specific"]},{key:"career_prospects",label:"Career Prospects",subcategories:["post_study_work","job_markets"]}];function ye(){const[I,M]=r.useState("manage"),[$,u]=r.useState(!1),[E,m]=r.useState(!1),[Q,y]=r.useState(null),[j,o]=r.useState(!1),[d]=a.useForm(),[f]=a.useForm(),[h,p]=r.useState(""),[n,L]=r.useState(""),[k,v]=r.useState([]),{data:S,isLoading:q,mutate:x}=O("/chatbot/superadmin/faqs/"),b=S?.results||[],P=S?.count||0;r.useEffect(()=>{if(!n.trim())v(b);else{const s=b.filter(t=>t.question.toLowerCase().includes(n.toLowerCase())||t.answer.toLowerCase().includes(n.toLowerCase())||t.category?.toLowerCase().includes(n.toLowerCase())||t.category?.toLowerCase().includes(n.toLowerCase()));v(s)}},[b,n]);const V=async()=>{try{o(!0);const s=await d.validateFields(),t={question:s.question,answer:s.answer,category:h||s.category,section:s.section||"Custom FAQ"};await g.post("/chatbot/superadmin/faqs/",t),i.success("FAQ added successfully!"),u(!1),d.resetFields(),p(""),x()}catch(s){const t=s.response?.data?.error||"Failed to add FAQ";i.error(t)}finally{o(!1)}},D=async()=>{if(Q)try{o(!0);const s=await f.validateFields(),t={question:s.question,answer:s.answer,category:s.category,section:s.section||"Custom FAQ"};await g.put(`/chatbot/superadmin/faqs/${Q.id}/`,t),i.success("FAQ updated successfully!"),m(!1),y(null),x()}catch(s){const t=s.response?.data?.error||"Failed to update FAQ";i.error(t)}finally{o(!1)}},R=async s=>{try{o(!0),await g.delete(`/chatbot/superadmin/faqs/${s.id}/`),i.success("FAQ deleted successfully!"),x()}catch(t){const K=t.response?.data?.error||"Failed to delete FAQ";i.error(K)}finally{o(!1)}},z=async()=>{try{o(!0),await g.post("/chatbot/superadmin/faqs/refresh-vectors/"),i.success("Vector database refreshed successfully!")}catch(s){const t=s.response?.data?.error||"Failed to refresh vector database";i.error(t)}finally{o(!1)}},B=s=>{y(s),f.setFieldsValue({question:s.question,answer:s.answer,category:s.category,section:s.section}),m(!0)},G=[{title:"Question",dataIndex:"question",key:"question",width:"30%",render:s=>e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"truncate",title:s,children:s})})},{title:"Answer",dataIndex:"answer",key:"answer",width:"35%",render:s=>e.jsx("div",{className:"max-w-sm",children:e.jsx("p",{className:"truncate",title:s,children:s})})},{title:"Category",dataIndex:"category",key:"category",width:"15%",render:s=>e.jsx(_,{color:"blue",children:s.replace(/_/g," ").replace(/\./g," - ")})},{title:"Section",dataIndex:"section",key:"section",width:"10%"},{title:"Actions",key:"actions",width:"10%",render:(s,t)=>e.jsxs(W,{children:[e.jsx(l,{type:"text",size:"small",icon:e.jsx(H,{}),onClick:()=>B(t)}),e.jsx(se,{title:"Delete FAQ",description:"Are you sure you want to delete this FAQ?",onConfirm:()=>R(t),okText:"Yes",cancelText:"No",children:e.jsx(l,{type:"text",size:"small",danger:!0,icon:e.jsx(X,{})})})]})}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"FAQ Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage FAQ entries that will be automatically indexed in the vector database for real-time chatbot responses."})]}),e.jsx(Z,{activeKey:I,onChange:M,items:[{key:"manage",label:"Manage FAQs",children:e.jsxs(w,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["FAQ Entries (",P,")"]}),e.jsx(l,{type:"default",icon:e.jsx(J,{}),onClick:()=>x(),loading:q,children:"Refresh"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{type:"default",icon:e.jsx(U,{}),onClick:z,loading:j,children:"Refresh Vector DB"}),e.jsx(l,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>u(!0),children:"Add FAQ"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(c.Search,{placeholder:"Search FAQs by question, answer, or category...",value:n,onChange:s=>L(s.target.value),style:{width:"100%",maxWidth:500},allowClear:!0})}),e.jsx(ee,{dataSource:k,columns:G,loading:q,rowKey:"chunk_id",pagination:{total:k.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,t)=>`${t[0]}-${t[1]} of ${s} items`}})]})},{key:"categories",label:"Categories",children:e.jsxs(w,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"FAQ Categories"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(s=>e.jsxs(w,{size:"small",children:[e.jsx("h4",{className:"font-medium text-blue-600 mb-2",children:s.label}),e.jsx("div",{className:"space-y-1",children:s.subcategories?.map(t=>e.jsx(_,{className:"mb-1",children:t.replace(/_/g," ")},t))})]},s.key))})]})}]}),e.jsx(N,{title:"Add New FAQ",open:$,onCancel:()=>{u(!1),d.resetFields(),p("")},footer:[e.jsx(l,{onClick:()=>u(!1),children:"Cancel"},"cancel"),e.jsx(l,{type:"primary",loading:j,onClick:V,children:"Add FAQ"},"submit")],width:700,children:e.jsxs(a,{form:d,layout:"vertical",children:[e.jsx(a.Item,{name:"question",label:"Question",rules:[{required:!0,message:"Please enter the question"}],children:e.jsx(c,{placeholder:"Type the student question..."})}),e.jsx(a.Item,{name:"answer",label:"Answer",rules:[{required:!0,message:"Please enter the answer"}],children:e.jsx(T,{rows:4,placeholder:"Type the answer..."})}),e.jsx(a.Item,{name:"category",label:"Category",rules:[{required:!h,message:"Please select a category or enter custom"}],children:e.jsxs(A,{placeholder:"Select a category",allowClear:!0,onChange:s=>{s!=="custom"&&p("")},children:[C.map(s=>s.subcategories?.map(t=>e.jsxs(F,{value:`${s.key}.${t}`,children:[s.label," - ",t.replace(/_/g," ")]},`${s.key}.${t}`))),e.jsx(F,{value:"custom",children:"Custom Category"})]})}),(d.getFieldValue("category")==="custom"||h)&&e.jsx(a.Item,{label:"Custom Category",rules:[{required:!0,message:"Please enter custom category"}],children:e.jsx(c,{placeholder:"Enter custom category (e.g., technical_support.api_issues)",value:h,onChange:s=>p(s.target.value)})}),e.jsx(a.Item,{name:"section",label:"Section",children:e.jsx(c,{placeholder:"Section name (optional)"})})]})}),e.jsx(N,{title:"Edit FAQ",open:E,onCancel:()=>{m(!1),y(null)},footer:[e.jsx(l,{onClick:()=>m(!1),children:"Cancel"},"cancel"),e.jsx(l,{type:"primary",loading:j,onClick:D,children:"Update FAQ"},"submit")],width:700,children:e.jsxs(a,{form:f,layout:"vertical",children:[e.jsx(a.Item,{name:"question",label:"Question",rules:[{required:!0,message:"Please enter the question"}],children:e.jsx(c,{placeholder:"Type the student question..."})}),e.jsx(a.Item,{name:"answer",label:"Answer",rules:[{required:!0,message:"Please enter the answer"}],children:e.jsx(T,{rows:4,placeholder:"Type the answer..."})}),e.jsx(a.Item,{name:"category",label:"Category",rules:[{required:!0,message:"Please select a category"}],children:e.jsx(A,{placeholder:"Select a category",children:C.map(s=>s.subcategories?.map(t=>e.jsxs(F,{value:`${s.key}.${t}`,children:[s.label," - ",t.replace(/_/g," ")]},`${s.key}.${t}`)))})}),e.jsx(a.Item,{name:"section",label:"Section",children:e.jsx(c,{placeholder:"Section name (optional)"})})]})})]})}export{ye as default};
